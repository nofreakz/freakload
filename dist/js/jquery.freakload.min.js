/*
 *  freakLoad - v0.1.0
 *  Preloader JS library
 *  https://github.com/nofreakz/freakLoad
 *
 *  Copyright (c) 2014
 *  MIT License
 */
!function(a,b,c){"use strict";function d(b,c){this.opt=a.extend(!0,{},h,c),this.init(b)}var e="freakLoad",f={node:void 0,url:"",data:{},priority:.5,tags:[],async:!0,progress:0,onStart:a.noop,onComplete:a.noop,xhr:null},g={items:[],loaded:0},h={async:!0,groupOrder:[],onStart:a.noop,onComplete:a.noop,item:{onStart:a.noop,onComplete:a.noop},group:{onStart:a.noop,onComplete:a.noop}};d.prototype={queue:{loaded:0,items:[],groups:{}},requested:{items:[],groups:[]},init:function(a){this._addItems(a),this.opt.onStart(),this.load()},load:function(){var a;if(this.opt.groupOrder.length)for(a in this.opt.groupOrder)this.loadGroup(this.opt.groupOrder[a]);this._request()},loadGroup:function(a){this._isGroup(a)?this._request(a):console.warn('No items was found to be loaded on the group "'+a+'".')},add:function(a,b){this._addItems(a),(b===!1?b:!0)&&this.load()},_addItems:function(a){var b=this.queue,c={},d="",e=0,f=0;a=this._normalizeItems(a),this._setPriority(a);for(e in a)if(c=a[e],b.items[b.items.length]=c,c.tags.length)for(f in c.tags)d=c.tags[f],this._createGroup(d),b.groups[d].items[b.groups[d].items.length]=c},_normalizeItems:function(b){var c={},d=0;b instanceof Array||(b=[b]);for(d in b)c=b[d],"object"!=typeof c&&(c={url:c}),b[d]=c=a.extend({},f,c);return b},_setPriority:function(a){return a.sort(function(a,b){return b.priority-a.priority}),a},_createGroup:function(b){this._isGroup(b)||(this.queue.groups[b]=a.extend(!0,{},g))},_isGroup:function(a){return this.queue.groups.hasOwnProperty(a)?!0:!1},_request:function(a){var b=this.queue,c=0,d=0;for(a&&(b=this.queue.groups[a]),d=b.items.length;d>c&&this.requested.items.length<this.queue.items.length;c++)this._load(b.items[c],b,a)},_load:function(c,d,e){if(-1===this.requested.items.indexOf(c.url)){var f=this;this.requested.items[this.requested.items.length]=c.url+(a.isPlainObject(c.data)?"":"?"+a.param(c.data)),(c.onStart!==a.noop?c.onStart:this.opt.item.onStart)(),-1===this.requested.groups.indexOf(e)&&(this.requested.groups[this.requested.groups.length]=e,this.opt.group.onStart(e)),console.log(c.tags),c.xhr=a.ajax({xhr:function(){var a=new b.XMLHttpRequest;return a.addEventListener("progress",function(a){a.lengthComputable&&(c.progress=a.loaded/a.total)},!1),a},url:c.url,data:c.data,async:c.async?c.async:f.opt.async}).success(function(b){d.loaded++,f.queue.loaded++,(c.onComplete!==a.noop?c.onComplete:f.opt.item.onComplete)(/\.(xml|json|script|html|text)$/.test(c.url)?b:"",c.node),!e||d.loaded!==d.items.length&&f.queue.loaded!==f.queue.items.length||f.opt.group.onComplete(e),f.queue.loaded===f.queue.items.length&&f.opt.onComplete(),c.xhr=null}).fail(function(b){a.error(b.responseText)})}}},a[e]=function(b,f){var g=arguments,h=a.data(c,e),i=h&&h[b]?h[b]:!1;g.length?h?h instanceof d?"function"==typeof i?i.apply(h,Array.prototype.slice.call(g,1)):a[e]("add",b):(!i||"string"==typeof b&&"_"===b.charAt(0))&&a.error("Method "+b+" does not exist on jQuery."+e):a.data(c,e,new d(b,f)):a.error("The jquery plugin "+e+" is not able to run whitout arguments or array of items to load.")},a.fn[e]=function(b,c){var d=a.map(this,function(c){var d=JSON.parse(JSON.stringify(c.dataset)),e=d.tags;return d.tags=e?e.replace(/\s+/g,"").split(","):[],a.extend({node:c},d,b)});a[e](d,c)}}(jQuery,window,document);