/*
 *  freakLoad - v0.1.0
 *  Preloader JS library
 *  https://github.com/nofreakz/freakLoad
 *
 *  Copyright (c) 2014
 *  MIT License
 */
!function(a,b,c){"use strict";function d(b,c){this.opt=a.extend(!0,{},h,c),this.init(b)}var e="freakLoad",f={node:void 0,url:"",data:{},priority:.5,tags:[],async:!0,progress:0,onStart:a.noop,onComplete:a.noop,xhr:null},g={items:[],loaded:0},h={async:!0,groupOrder:[],onStart:a.noop,onComplete:a.noop,item:{onStart:a.noop,onComplete:a.noop},group:{onStart:a.noop,onComplete:a.noop}};d.prototype={data:{queue:{loaded:0,items:[],groups:{}},requested:{items:[],groups:[]},progress:0},init:function(a){this._addItems(a),this.opt.onStart(),this.load()},load:function(){var a;if(this.opt.groupOrder.length)for(a in this.opt.groupOrder)this.loadGroup(this.opt.groupOrder[a]);this._request()},loadGroup:function(a){this._isGroup(a)?this._request(a):console.warn('No items was found to be loaded on the group "'+a+'".')},add:function(a,b){this._addItems(a),(b===!1?b:!0)&&this.load()},abort:function(a){if(a)return void _abortItem(a);for(var b=this.queue.loaded;b<this.queue.length;b++)_abortItem(this.queue.items[b])},getData:function(){return this.data},_addItems:function(a){var b=this.data.queue,c={},d="",e=0,f=0;a=this._normalizeItems(a),this._setPriority(a);for(e in a)if(c=a[e],b.items[b.items.length]=c,c.tags.length)for(f in c.tags)d=c.tags[f],this._createGroup(d),b.groups[d].items[b.groups[d].items.length]=c},_abortItem:function(a){a.xhr.abort(),a.progress=0},_normalizeItems:function(b){var c={},d=0;b instanceof Array||(b=[b]);for(d in b)c=b[d],"object"!=typeof c&&(c={url:c}),b[d]=c=a.extend({},f,c),c.priority=parseFloat(c.priority)||.1;return b},_setPriority:function(a){return a.sort(function(a,b){return b.priority-a.priority}),a},_createGroup:function(b){this._isGroup(b)||(this.data.queue.groups[b]=a.extend(!0,{},g))},_isGroup:function(a){return this.data.queue.groups.hasOwnProperty(a)?!0:!1},_request:function(a){var b=this.data,c=b.queue,d=0,e=0;for(a&&(c=b.queue.groups[a]),e=c.items.length;e>d&&b.requested.items.length<b.queue.items.length;d++)this._load(c.items[d],c,a)},_load:function(c,d,e){var f=this,g=this.data;-1===g.requested.items.indexOf(c.url)&&(g.requested.items[g.requested.items.length]=c.url+(a.isPlainObject(c.data)?"":"?"+a.param(c.data)),(c.onStart!==a.noop?c.onStart:this.opt.item.onStart)(c.node),e&&-1===g.requested.groups.indexOf(e)&&(g.requested.groups[g.requested.groups.length]=e,this.opt.group.onStart(e)),c.xhr=a.ajax({xhr:function(){var a=new b.XMLHttpRequest;return a.addEventListener("progress",function(a){a.lengthComputable&&(c.progress=a.loaded/a.total)},!1),a},url:c.url,data:c.data,async:c.async?c.async:f.opt.async}).success(function(b){e&&d.loaded++,g.queue.loaded++,(c.onComplete!==a.noop?c.onComplete:f.opt.item.onComplete)(/\.(xml|json|script|html|text)$/.test(c.url)?b:"",c.node),!e||d.loaded!==d.items.length&&g.queue.loaded!==g.queue.items.length||f.opt.group.onComplete(e),g.queue.loaded===g.queue.items.length&&f.opt.onComplete(),c.xhr="complete"}).fail(function(a){throw c.xhr="fail",a.responseText}))},_updateProgress:function(){}},a[e]=function(b,f){var g=arguments,h=a.data(c,e),i=h&&h[b]?h[b]:!1;if(!g.length)throw"The jquery plugin "+e+" is not able to run whitout arguments or array of items to load.";if(h){if(h instanceof d){if("function"==typeof i)return i.apply(h,Array.prototype.slice.call(g,1));a[e]("add",b)}else if(!i||"string"==typeof b&&"_"===b.charAt(0))throw"Method "+b+" does not exist on jQuery."+e}else a.data(c,e,new d(b,f))},a.fn[e]=function(b,c){var d=a.map(this,function(c){var d=JSON.parse(JSON.stringify(c.dataset)),e=d.tags;return d.tags=e?e.replace(/\s+/g,"").split(","):[],a.extend({node:c},d,b)});a[e](d,c)}}(jQuery,window,document);